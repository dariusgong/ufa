define("taurus/grid/1.0.0/grid",["taurus/querystring/1.0.0/querystring"],function(e){var t=e("taurus/querystring/1.0.0/querystring");return function(e){var n={paging:!0,pageTheme:"default",method:"GET",root:"data",pageSize:10,showPageSize:!1,start:1,isREST:!0,defaultParams:{},tableClass:"gridTable",buttonWrapperClass:"gridRowButton",buttonClass:"gridButton",pageClass:"gridPage"};e.fn.grid=function(r){function c(n){typeof n=="string"&&(n=t.parse(n)),e.extend(l,n),v()}function h(){return f}function p(e,t){l[e]=t}function d(e){o.url=e}function v(){typeof o.defaultParams=="string"&&(o.defaultParams=t.parse(o.defaultParams)),l.click&&(u=1),l.start=(u-1)*a+1,l.end=l.start+a-1,l.pageSize=a,m()}function m(){o.paging||(l.end=99999),e.ajax({url:o.isREST?e.restUrl(o.url,l):o.url,type:o.method,data:o.isREST&&o.method.toUpperCase()=="GET"?{}:l,success:function(t){var n=e("<table />").addClass(o.tableClass);f=t[o.root];var r=E(o.fields);n.append(r);var u=S(o.fields,t);n.append(u),s.empty(),s.append(n);var a;o.paging&&(o.pageTheme=="Theme1"?a=y(t):a=b(t),a.appendTo(s));if(o.buttons){var l=e("<div />").addClass(o.buttonWrapperClass),c=e("<ul />").addClass(o.buttonClass).appendTo(l);e.each(o.buttons,function(n,r){var s=e("<li />"),o=e('<a href="#" />').appendTo(s);r.action?o.click(function(){return r.action.call(i,t),!1}):o.attr("href",r.href),o.append(e("<span />").html(r.text)),s.appendTo(c)}),l.prependTo(s)}o.callback&&o.callback(t)}})}function g(n){var r=e(".cur_page").val();u=parseInt(r)||1,u=u>n?n:u,u=u<1?1:u;var i=(u-1)*a+1,s=i+a-1;return typeof o.defaultParams=="string"&&(o.defaultParams=t.parse(o.defaultParams)),l.start=i,l.end=s,l.pageSize=a,m(),!1}function y(t){var n=t.total,r=e("<div />").addClass("gridBtn"),i=e("<em />"),s=Math.ceil(n/a),f=e("<div />").addClass("gridPages").appendTo(i);(o.extraContent||e.isFunction(o.extraContent))&&f.append(o.extraContent(t)),i.appendTo(r);var l="共&nbsp;"+n+"&nbsp;条 第&nbsp;"+u+"&nbsp;页&nbsp;/&nbsp;共&nbsp;"+s+"&nbsp;页&nbsp;";f.append(l);if(s>1){var c=u-2<1?1:u-2,h=u+2>s?s:u+2;u>1&&(w(1,"首页",f),w(u-1,"&lt;",f));for(var p=c;p<=h;p++)if(p!=u)w(p,p,f);else var d=e("<a />").html(p).appendTo(f).attr("index",p).addClass("focus");u<h&&(w(u+1,"&gt;",f),w(s,"尾页",f));var v=e('<input class="cur_page" size="4"/>').val(u).keyup(function(e){e.keyCode==13&&g(s)}),m=e('<a href="javascript:void(0)"/>').html("确定").click(function(){o.showPageSize&&(a=parseInt(e(".page_size").val())||o.pageSize,a=a<1?o.pageSize:a),g(s)});f.append("&nbsp;到第&nbsp;").append(v).append("&nbsp;页&nbsp; ").append(m)}return r}function b(t){var n=t.total,r=Math.ceil(n/a),i=e("<div />").addClass(o.pageClass);(o.extraContent||e.isFunction(o.extraContent))&&i.append(o.extraContent(t));var s="当前第"+u+"页/共"+r+"页 总共记录数"+n+"条";i.append(s);if(r>1){var f=u-2<1?1:u-2,l=u+2>r?r:u+2;u>1&&(w(1,"首页",i),w(u-1,"上页",i)),u<l&&(w(u+1,"下页",i),w(r,"尾页",i));var c=e('<input class="cur_page" size="4"/>').val(u).keyup(function(e){e.keyCode==13&&g(r)}),h=e('<a href="javascript:void(0)"/>').html("确定").click(function(){o.showPageSize&&(a=parseInt(e(".page_size").val())||o.pageSize,a=a<1?o.pageSize:a),g(r)});i.append("第").append(c).append("页"),o.showPageSize&&i.append(" 每页显示").append(e('<input class="page_size" size="4"/>').val(a)).append("条"),i.append(h)}return i}function w(n,r,i){var s=e("<a />").html(r).appendTo(i).attr("index",n);s.attr("href","#").click(function(){u=parseInt(e(this).attr("index"));var n=(u-1)*a+1,r=n+a-1;return typeof o.defaultParams=="string"&&(o.defaultParams=t.parse(o.defaultParams)),l.start=n,l.end=r,l.pageSize=a,m(),!1})}function E(t){var n=e("<thead />"),r=e("<tr />").appendTo(n);return e.each(t,function(t,i){var s=e("<th />").appendTo(r);i.type=="hidden"&&s.hide();if(i.type=="checkbox")s.append(e("<span />").addClass("checkbox").append(e("<input />").attr("type","checkbox").change(function(){n.parent().find(":checkbox[name="+i.id+"]").attr("checked",this.checked)})));else{var o=e("<span />").html(i.name||"");i.headClick&&typeof i.headClick=="function"&&o.click(i.headClick),o.appendTo(s)}i.title=s}),n}function S(t,n){var r=e("<tbody />");return o.sortable&&r.sortable(),e.each(n[o.root],function(t,n){var s=l.start+t,u=e("<tr />").appendTo(r);e.each(o.fields,function(t,o){var a=n[o.id],f=a;o.operation&&(o.render=function(){var t=e("<div />");return e.each(o.operation,function(r,s){if(s.display&&!e.isFunction(s.display)&&s.display!="N"||s.display&&e.isFunction(s.display)&&s.display.call(i,n)||s.display==undefined){var o=e('<a href="#" />').attr("class","button_a").append(e("<span />").html(s.text)).click(function(){return s.confirm?e.msg.confirm(s.confirm,function(e){e&&s.action.call(i,n)}):s.action.call(i,n),!1});t.append(o)}}),t.children()});if(o.options){var l=o.options;o.render=function(e,t,n){return l[n]}}e.isFunction(o.render)&&(f=o.render(n,o.id,a)),f||(f="");var c=e("<td />").appendTo(u);o.type=="date"&&f&&(f=e.format.formatDate(new Date(f))),o.type=="currency"&&f&&(f=e.format.formatCurrency(f)),o.type=="time"&&f&&(f=e.format.formatTime(new Date(f))),o.checkboxCondition=o.checkboxCondition||!0;if(o.type=="checkbox")(o.checkboxCondition&&!e.isFunction(o.checkboxCondition)||o.checkboxCondition&&e.isFunction(o.checkboxCondition)&&o.checkboxCondition.call(i,n))&&c.append(e("<input />").attr({type:"checkbox",name:o.id,value:a}).change(function(){var e=r.parent();if(!this.checked)e.find("th :checkbox").attr("checked",!1);else{var t=!0;e.find("td :checkbox").each(function(e,n){n.checked||(t=!1)}),t&&e.find("th :checkbox").attr("checked",!0)}}));else if(o.type=="radio")if(document.uniqueID){var h=document.createElement("<input type='radio' name='"+o.id+"' value='"+a+"'>");c.append(h)}else c.append(e("<input />").attr({type:"radio",name:o.id,value:a}));else if(o.type=="hidden")c.append(e("<input />").attr({type:"hidden",name:o.id,value:a})),c.hide();else if(o.type=="seq")c.append(s);else if(o.maxlength){var p=e.abbreviate(f,o.maxlength);c.html(p).attr("title",f)}else c.html(f);o.width&&c.css("width",(o.width+"").indexOf("%")==-1?o.width+"px":o.width),o.style&&c.css(o.style),o.body=c})}),e("#ui-datepicker-div").hide(),r}if(this.data("delegate")&&!r)return this.data("delegate");var i={query:c,refresh:v,setUrl:d,setParam:p,render:m};this.data("delegate",i);var s=this,o=e.extend({},n,r),u=1,a=o.pageSize,f,l;return typeof o.defaultParams=="string"&&(o.defaultParams=t.parse(o.defaultParams)),l={},l.start=o.start,l.end=o.start+a-1,l.pageSize=a,e.extend(l,o.defaultParams),m(),i},e.restUrl=function(t,n){var r=t.match(/ {(.* ? )} /g);return e.each(r||[],function(e,r){var i=r.substr(1,r.length-2),s=n[i]||"";t=t.replace(r,s)}),t},e.abbreviate=function(t,n){return e.getLength(t)>n?e.substr(t,0,n-2)+"...":t},e.substr=function(e,t,n){var r=escape(e),i=0,s=0,o;while(i<=n)o=s,r.charAt(s)=="%"?r.charAt(s+1)=="u"?(s+=6,i+=2):(s+=3,i++):(s++,i++);return unescape(r.substring(0,o))},e.getLength=function(e){if(!e)return 0;var t=escape(e).match(/ % u /g);return e.length+(t?t.length:0)},e.format=function(){function e(e){switch(e){case"Jan":return"01";case"Feb":return"02";case"Mar":return"03";case"Apr":return"04";case"May":return"05";case"Jun":return"06";case"Jul":return"07";case"Aug":return"08";case"Sep":return"09";case"Oct":return"10";case"Nov":return"11";case"Dec":return"12";default:return e}}function t(e){var t=e;t.indexOf(".")!==-1&&(t=t.substring(0,t.indexOf(".")));var n=t.split(":");return n.length===3?(hour=n[0],minute=n[1],second=n[2],second.length>2&&(second=second.substring(0,2)),{time:t,hour:hour,minute:minute,second:second}):{time:"",hour:"",minute:"",second:""}}function n(n,r){try{var i=null,s=null,o=null,u=null;if(typeof n.getFullYear=="function")i=n.getFullYear(),s=n.getMonth()+1,o=n.getDate(),u=t(n.toTimeString());else{var a=n.split(" ");switch(a.length){case 6:i=a[5],s=e(a[1]),o=a[2],u=t(a[3]);break;case 2:var f=a[0].split("-");i=f[0],s=f[1],o=f[2],u=t(a[1]);break;default:return n}}var l="",c="";for(var h=0;h<r.length;h++){var p=r.charAt(h);l+=p;switch(l){case"dd":c+=(o<10?"0":"")+o,l="";break;case"MM":c+=(s<10?"0":"")+s,l="";break;case"yyyy":c+=i,l="";break;case"HH":c+=u.hour,l="";break;case"hh":c+=u.hour===0?12:u.hour<13?u.hour:u.hour-12,l="";break;case"mm":c+=u.minute,l="";break;case"ss":c+=u.second,l="";break;case"a":c+=u.hour>12?"PM":"AM",l="";break;case" ":c+=p,l="";break;case"/":c+=p,l="";break;case":":c+=p,l="";break;default:l.length===2&&l.indexOf("y")!==0?(c+=l.substring(0,1),l=l.substring(1,2)):l.length===3&&l.indexOf("yyy")===-1&&(l="")}}return c}catch(d){return n}}function r(e){var t=e;number=t+"",numArr=number.split("."),number=numArr[0],tail=numArr[1];if(!t)return"0.00";numArr.length==1?tail="00":tail=numArr[1].length==1?numArr[1]+"0":numArr[1];if(number.length<=3)t=number==""?"0":number+"."+tail;else{var n=number.length%3,r=n==0?"":number.substring(0,n);for(var i=0;i<Math.floor(number.length/3);i++)n==0&&i==0?r+=number.substring(n+3*i,n+3*i+3):r+=","+number.substring(n+3*i,n+3*i+3);t=r+"."+tail}return t}return{date:n,formatDate:function(e){return n(e,"yyyy-MM-dd")},formatTime:function(e){return n(e,"yyyy-MM-dd HH:mm:ss")},formatCurrency:function(e){return r(e)}}}()}});